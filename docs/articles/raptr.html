<!-- Generated by staticdocs: do not edit by hand -->
<html>
  <head>
  <meta charset="utf-8">
<title>raptr: Representative and Adequate Prioritisation Toolkit in R. raptr</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



<!-- staticdocs -->
<link href="../staticdocs.css" rel="stylesheet">

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container">
        <header>
        
<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">raptr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jeffreyhanson/raptr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
        
        </header>

        
<div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>raptr: Representative and Adequate Prioritisation Toolkit in R</h1>
            
            <h4 class="date"><em>25 October 2016</em></h4>
          </div>

    
    
<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This vignette illustrates the basic usage of the <em>raptr R</em> package.</p>
<p>To load the <em>raptr R</em> package and learn more about the package, type the following code into R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load raptr R package</span>
<span class="kw">library</span>(raptr)

<span class="co"># show package overview</span>
?raptr</code></pre></div>
<p>The <em>raptr R</em> package uses a range of S4 classes to store conservation planning data, parameters, and prioritisations (Table 1).</p>
<p>Table 1: Main classes in the <em>raptr R</em> package</p>
<table>
<colgroup>
<col width="20%" />
<col width="79%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><strong>Class</strong></th>
<th align="left"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>ManualOpts</code></td>
<td align="left">place-holder class for manually specified solutions</td>
</tr>
<tr class="even">
<td align="center"><code>GurobiOpts</code></td>
<td align="left">stores parameters for solving optimisation problems using <em>Gurobi</em></td>
</tr>
<tr class="odd">
<td align="center"><code>RapUnreliableOpts</code></td>
<td align="left">stores control variables parameters for the unreliable problem formulation</td>
</tr>
<tr class="even">
<td align="center"><code>RapReliableOpts</code></td>
<td align="left">stores control variables for the reliable problem formulation</td>
</tr>
<tr class="odd">
<td align="center"><code>DemandPoints</code></td>
<td align="left">stores the coordinates and weights for a given species and attribute space</td>
</tr>
<tr class="even">
<td align="center"><code>PlanningUnitPoints</code></td>
<td align="left">stores the coordinates and ids for planning units that can be used to preserve a given species</td>
</tr>
<tr class="odd">
<td align="center"><code>AttributeSpace</code></td>
<td align="left">stores the coordinates for planning units and the demand points for each species</td>
</tr>
<tr class="even">
<td align="center"><code>RapData</code></td>
<td align="left">stores the all the planning unit, species, and attribute space data</td>
</tr>
<tr class="odd">
<td align="center"><code>RapUnsolved</code></td>
<td align="left">stores all the data, control variables, and parameters needed to generate prioritisations</td>
</tr>
<tr class="even">
<td align="center"><code>RapResults</code></td>
<td align="left">stores the prioritisations and summary statistics generated after solving a problem</td>
</tr>
<tr class="odd">
<td align="center"><code>RapSolved</code></td>
<td align="left">stores the input data and output results</td>
</tr>
</tbody>
</table>
</div>
<div id="getting-started" class="section level1">
<h1>Getting started</h1>
<p>This tutorial is designed to provide users with an understanding of how to use the <em>raptr R</em> package to generate and compare solutions. This tutorial uses several additional packages, so first we will run the following code to load them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load packages for tutorial</span>
<span class="kw">library</span>(parallel)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(RandomFields)
<span class="kw">library</span>(rgeos)

<span class="co"># set seed for reproducibility</span>
<span class="kw">set.seed</span>(<span class="dv">500</span>)

<span class="co"># set number of threads for computation</span>
threads &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">max</span>(<span class="dv">1</span>, <span class="kw">detectCores</span>()-<span class="dv">2</span>))</code></pre></div>
</div>
<div id="simulated-examples" class="section level1">
<h1>Simulated examples</h1>
<div id="data" class="section level2">
<h2>Data</h2>
<p>To investigate the behaviour of the problem, we will generate prioritisations for three simulated species. We will use the unreliable formulation of the problem to understand the basics, and later move onto the reliable formulation. The first species (termed ‘uniform’) will represent a hyper-generalist. This species will inhabit all areas with equal probability. The second species (termed ‘normal’) will represent a species with a single range core. The third species (termed ‘bimodal’) will represent a species with two distinct ecotypes, each with their own range core. To reduce computational time for this example, we will use a 10 <span class="math inline">\(\times\)</span> 10 grid of square planning units.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make planning units</span>
sim_pus &lt;-<span class="st"> </span><span class="kw">sim.pus</span>(100L)

<span class="co"># simulate species distributions</span>
sim_spp &lt;-<span class="st"> </span><span class="kw">lapply</span>(
    <span class="kw">c</span>(<span class="st">&#39;uniform&#39;</span>, <span class="st">&#39;normal&#39;</span>, <span class="st">&#39;bimodal&#39;</span>),
    sim.species,
    <span class="dt">n=</span><span class="dv">1</span>,
    <span class="dt">x=</span>sim_pus,
    <span class="dt">res=</span><span class="dv">1</span>
)</code></pre></div>
<p>Let’s see what these species’ distributions look like.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot species</span>
<span class="kw">plot</span>(
    <span class="kw">stack</span>(sim_spp),
    <span class="dt">main=</span><span class="kw">c</span>(<span class="st">&#39;Uniform species&#39;</span>,<span class="st">&#39;Normal species&#39;</span>,<span class="st">&#39;Bimodal species&#39;</span>),
    <span class="dt">addfun=</span>function(){<span class="kw">lines</span>(sim_pus)},
    <span class="dt">nc=</span><span class="dv">3</span>
)</code></pre></div>
<div class="figure">
<img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-4-1.png" alt="Distribution of three simulated species. Each square represents a planning unit. The colour of each square denotes the probability that individuals from each species occupy it." />
<p class="caption"><em>Distribution of three simulated species. Each square represents a planning unit. The colour of each square denotes the probability that individuals from each species occupy it.</em></p>
</div>
<p>Next, we will generate a set of demand points. To understand the effects of probabilities and weights on the demand points, we will generate the demand points in geographic space. These demand points will be the centroids of the planning units. Additionally, we will use the same set of demand points for each species and only vary the weights of the demand points between species. <strong>Note that we are only using the same distribution of demand points for different species for teaching purposes. It is strongly recommended to use different demand points for different species in real-world conservation planning exercises.</strong> See the case-study section of this tutorial for examples on how to generate suitable demand points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate coordinates for pus/demand points</span>
pu_coords &lt;-<span class="st"> </span><span class="kw">gCentroid</span>(sim_pus, <span class="dt">byid=</span><span class="ot">TRUE</span>)

<span class="co"># calculate weights</span>
sim_dps &lt;-<span class="st"> </span><span class="kw">lapply</span>(
    sim_spp,
    function(x) {
        <span class="kw">return</span>(<span class="kw">extract</span>(x, pu_coords))
    }
)

<span class="co"># create demand point objects</span>
sim_dps &lt;-<span class="st"> </span><span class="kw">lapply</span>(
    sim_dps,
    function(x) {
        <span class="kw">return</span>(
            <span class="kw">DemandPoints</span>(
                pu_coords@coords,
                <span class="dt">weights=</span><span class="kw">c</span>(x)
            )
        )
    }
)</code></pre></div>
<p>Now, we will construct a <code>RapUnsolved</code> object to store our input data and parameters. This contains all the information to generate prioritisations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## create RapUnreliableOpts object
<span class="co"># this stores parameters for the unreliable formulation problem (ie. BLM)</span>
sim_ro &lt;-<span class="st"> </span><span class="kw">RapUnreliableOpts</span>()

## create RapData object
<span class="co"># create data.frame with species info</span>
species &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">name=</span><span class="kw">c</span>(<span class="st">&#39;uniform&#39;</span>, <span class="st">&#39;normal&#39;</span>, <span class="st">&#39;bimodal&#39;</span>)
)

## create data.frame with species and space targets
<span class="co"># amount targets at 20% (denoted with target=0)</span>
<span class="co"># space targets at 20% (denoted with target=1)</span>
targets &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(
    <span class="dt">species=</span><span class="dv">1</span>:<span class="dv">3</span>,
    <span class="dt">target=</span><span class="dv">0</span>:<span class="dv">1</span>,
    <span class="dt">proportion=</span><span class="fl">0.2</span>
)

<span class="co"># calculate probability of each species in each pu</span>
pu_probabilities &lt;-<span class="st"> </span><span class="kw">calcSpeciesAverageInPus</span>(sim_pus, <span class="kw">stack</span>(sim_spp))

## create AttributeSpace object
<span class="co"># this stores the coordinates of the planning units in an attribute space</span>
<span class="co"># and the coordinates and weights of demand points in the space</span>

pu_points &lt;-<span class="st"> </span><span class="kw">PlanningUnitPoints</span>(
    <span class="dt">coords=</span>pu_coords@coords,
    <span class="dt">ids=</span><span class="kw">seq_len</span>(<span class="kw">nrow</span>(sim_pus@data))
)

attr_spaces &lt;-<span class="st"> </span><span class="kw">AttributeSpaces</span>(
    <span class="kw">list</span>(
        <span class="kw">AttributeSpace</span>(
            <span class="dt">planning.unit.points=</span>pu_points,
            <span class="dt">demand.points=</span>sim_dps[[<span class="dv">1</span>]],
            <span class="dt">species=</span>1L
        ),
        <span class="kw">AttributeSpace</span>(
            <span class="dt">planning.unit.points=</span>pu_points,
            <span class="dt">demand.points=</span>sim_dps[[<span class="dv">2</span>]],
            <span class="dt">species=</span>2L
        ),
        <span class="kw">AttributeSpace</span>(
            <span class="dt">planning.unit.points=</span>pu_points,
            <span class="dt">demand.points=</span>sim_dps[[<span class="dv">3</span>]],
            <span class="dt">species=</span>3L
        )
    ),
    <span class="dt">name=</span><span class="st">&#39;geographic&#39;</span>
)

<span class="co"># generate boundary data information</span>
boundary &lt;-<span class="st"> </span><span class="kw">calcBoundaryData</span>(sim_pus)

## create RapData object
<span class="co"># this stores all the input data for the prioritisation</span>
sim_rd &lt;-<span class="st"> </span><span class="kw">RapData</span>(
    sim_pus@data,
    species,
    targets,
    pu_probabilities,
    <span class="kw">list</span>(attr_spaces),
    boundary,
    <span class="kw">SpatialPolygons2PolySet</span>(sim_pus)
)

## create RapUnsolved object
<span class="co"># this stores all the input data and parameters needed to generate prioritisations</span>
sim_ru &lt;-<span class="st"> </span><span class="kw">RapUnsolved</span>(sim_ro, sim_rd)</code></pre></div>
</div>
<div id="single-species-prioritisations" class="section level2">
<h2>Single-species prioritisations</h2>
<div id="amount-based-targets" class="section level3">
<h3>Amount-based targets</h3>
<p>To investigate the effects of space-based targets, we will generate a prioritisation for each species using only amount-based targets and compare them to prioritisations generated using amount- and space-based targets. To start off, we will generate a prioritisation for the uniform species using amount-based targets. To do this, we will generate a new <code>sim_ru</code> object by subsetting out the data for the uniform species from the <code>sim_ru</code> object. Then, we will update the targets in the new object. Finally, we will solve the object to generate a prioritisation that fulfills the targets for minimal cost.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create new object with just the uniform species</span>
sim_ru_s1 &lt;-<span class="st"> </span><span class="kw">spp.subset</span>(sim_ru, <span class="st">&#39;uniform&#39;</span>)

<span class="co"># update amount targets to 20% and space targets to 0%</span>
sim_ru_s1 &lt;-<span class="st"> </span><span class="kw">update</span>(sim_ru_s1, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="ot">NA</span>, <span class="dt">solve=</span><span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># solve problem to identify prioritisation</span>
sim_rs_s1_amount &lt;-<span class="st"> </span><span class="kw">solve</span>(sim_ru_s1, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Optimize a model with 1 rows, 100 columns and 100 nonzeros
## Coefficient statistics:
##   Matrix range    [5e-01, 5e-01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+01, 1e+01]
## Found heuristic solution: objective 20
## Presolve removed 1 rows and 100 columns
## Presolve time: 0.00s
## Presolve: All rows and columns removed
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.000000000000e+01, best bound 2.000000000000e+01, gap 0.0%</code></pre>
<pre><code>## Warning in validityMethod(object): object@space.held contains values less
## than 0, some species are really poorly represented</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## show summary
<span class="co"># note the format for this is similar to that used by Marxan</span>
<span class="co"># see ?raptr::summary for details on this table</span>
<span class="kw">summary</span>(sim_rs_s1_amount)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    20   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1              42               168               10
##   Connectivity_In_Fraction
## 1                0.1909091</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s1_amount)</code></pre></div>
<pre><code>##   uniform
## 1     0.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s1_amount)</code></pre></div>
<pre><code>##   uniform (Space 1)
## 1        -0.2363636</code></pre>
<p>Now that we have generated a prioritisation, let’s see what it looks like. We can use the <code>spp.plot</code> method to see how the prioritisation overlaps with the uniform species’ distribution. Note that since all planning units have equal probabilities for this species, all planning units have the same fill colour.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the uniform species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s1_amount, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Uniform species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-10-1.png" title="_A prioritisation for the uniformly distributed species generated using amount-based targets (20\%). Sqaures represent planning units. Planning units with a green border are selected for prioritisation, and their colour denotes the probability they are inhabited by the species._" alt="_A prioritisation for the uniformly distributed species generated using amount-based targets (20\%). Sqaures represent planning units. Planning units with a green border are selected for prioritisation, and their colour denotes the probability they are inhabited by the species._" style="display: block; margin: auto;" /></p>
<p>The prioritisation for the uniform species appears to be just a random selection of planning units. This behavior is due to the fact that any prioritisation with 20 planning units is optimal. By relying on just amount targets, this solution may preserve a section of the species’ range core, or just focus on the range margin, or some random part of its range–no emphasis is directed towards preserving different parts of the species’ range. This behavior highlights a fundamental limitation of just using amount-based targets. In the absence of additional criteria, conventional reserve selection problems do not contain any additional information to identify the most effective prioritisation.</p>
<p>Now, we will generate a prioritisation for the normally distributed species using amount-based targets. We will use a similar process to what we used for the uniformly distributed species, but for brevity, we will use code to generate solutions immediately after updating the object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create new object with just the normal species</span>
sim_ru_s2 &lt;-<span class="st"> </span><span class="kw">spp.subset</span>(sim_ru, <span class="st">&#39;normal&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># update amount targets to 20% and space targets to 0% and solve it</span>
sim_rs_s2_amount &lt;-<span class="st"> </span><span class="kw">update</span>(sim_ru_s2, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="ot">NA</span>, <span class="dt">solve=</span><span class="ot">TRUE</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Optimize a model with 1 rows, 100 columns and 100 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-02, 7e-01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [7e+00, 7e+00]
## Found heuristic solution: objective 27
## Presolve removed 0 rows and 86 columns
## Presolve time: 0.00s
## Presolved: 1 rows, 14 columns, 14 nonzeros
## Variable types: 0 continuous, 14 integer (0 binary)
## Presolved: 1 rows, 14 columns, 14 nonzeros
## 
## 
## Root relaxation: objective 9.864476e+00, 6 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    9.86448    0    1   27.00000    9.86448  63.5%     -    0s
## H    0     0                      10.0000000    9.86448  1.36%     -    0s
## 
## Explored 0 nodes (6 simplex iterations) in 0.00 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.000000000000e+01, best bound 1.000000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_rs_s2_amount)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    10   10             10                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1              12               192               16
##   Connectivity_In_Fraction
## 1               0.05454545</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s2_amount)</code></pre></div>
<pre><code>##      normal
## 1 0.2026153</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s2_amount)</code></pre></div>
<pre><code>##   normal (Space 1)
## 1        0.5909494</code></pre>
<p>Now let’s visualise the prioritisation we made for the normal species.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the normal species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s2_amount, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Normal species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-14-1.png" title="_A prioritisation for the normally distributed species generated using amount-based targets (20\%). See Figure 3 caption for conventions._" alt="_A prioritisation for the normally distributed species generated using amount-based targets (20\%). See Figure 3 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>The amount-based prioritisation for the normal species focuses only on the species’ range core. This prioritisation fails to secure any peripheral parts of the species’ distribution. As a consequence, it may miss out on populations with novel adaptations to environmental conditions along the species’ range margin.</p>
<p>Now, let’s generate an amount-based target for the bimodally distributed species view it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># create new object with just the bimodal species</span>
sim_ru_s3 &lt;-<span class="st"> </span><span class="kw">spp.subset</span>(sim_ru, <span class="st">&#39;bimodal&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># update amount targets to 20% and space targets to 0% and solve it</span>
sim_rs_s3_amount &lt;-<span class="st"> </span><span class="kw">update</span>(sim_ru_s3, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="ot">NA</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Optimize a model with 1 rows, 100 columns and 100 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e-01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [7e+00, 7e+00]
## Found heuristic solution: objective 21
## Presolve removed 0 rows and 75 columns
## Presolve time: 0.00s
## Presolved: 1 rows, 25 columns, 25 nonzeros
## Variable types: 0 continuous, 25 integer (0 binary)
## Presolved: 1 rows, 25 columns, 25 nonzeros
## 
## 
## Root relaxation: objective 7.919039e+00, 18 iterations, 0.00 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    7.91904    0    1   21.00000    7.91904  62.3%     -    0s
## H    0     0                       8.0000000    7.91904  1.01%     -    0s
## 
## Explored 0 nodes (18 simplex iterations) in 0.00 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 8.000000000000e+00, best bound 8.000000000000e+00, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the bimodal species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s3_amount, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Bimodal species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-17-1.png" title="_A prioritisation for the bimodally distributed species generated using amount-based targets (20\%). See Figure 3 caption for conventions._" alt="_A prioritisation for the bimodally distributed species generated using amount-based targets (20\%). See Figure 3 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_rs_s3_amount)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL     8    8              8                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               9               197               14
##   Connectivity_In_Fraction
## 1               0.04090909</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s3_amount)</code></pre></div>
<pre><code>##     bimodal
## 1 0.2018391</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s3_amount)</code></pre></div>
<pre><code>##   bimodal (Space 1)
## 1         0.1200278</code></pre>
<p>The amount-based prioritisation for the bimodally distributed species only selects planning units in the bottom left corner of the study area. This prioritisation only preserves individuals belonging to one of the two ecotypes. As a consequence, this prioritisation may fail to preserve a representative sample of the genetic variation found inside this species.</p>
</div>
<div id="amount-based-and-space-based-targets" class="section level3">
<h3>Amount-based and space-based targets</h3>
<p>Now that we have generated a prioritisation for each species using only amount-based targets, we will generate a prioritisations using both amount-based and space-targets. To do this we will update the space targets in our amount-based prioritisations to 85%, and store the new prioritisations in new objects.</p>
<p>First, let’s do this for the uniform species.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation</span>
sim_rs_s1_space &lt;-<span class="st"> </span><span class="kw">update</span>(sim_rs_s1_amount, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="fl">0.85</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 10102 rows, 10100 columns and 40000 nonzeros
## Coefficient statistics:
##   Matrix range    [5e-01, 8e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 1e+02]
## Found heuristic solution: objective 88
## Presolve removed 36 rows and 0 columns
## Presolve time: 2.17s
## Presolved: 10066 rows, 10100 columns, 40104 nonzeros
## Variable types: 0 continuous, 10100 integer (10100 binary)
## Presolved: 10066 rows, 10100 columns, 40104 nonzeros
## 
## Presolve removed 10066 rows and 10100 columns
## 
## Root relaxation: objective 2.000000e+01, 621 iterations, 0.09 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## *    0     0               0      20.0000000   20.00000  0.00%     -    2s
## 
## Explored 0 nodes (1086 simplex iterations) in 2.34 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.000000000000e+01, best bound 2.000000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_rs_s1_space)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    20   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               8               143               69
##   Connectivity_In_Fraction
## 1               0.03636364</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s1_space)</code></pre></div>
<pre><code>##   uniform
## 1     0.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s1_space)</code></pre></div>
<pre><code>##   uniform (Space 1)
## 1         0.9309091</code></pre>
<p>Let’s take a look at the prioritisation for the uniform species with amount-based and space-based targets. Then, let’s compare the solutions for the amount-based prioritisation with the new prioritisation using both amount and space targets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the uniform species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s1_space, <span class="st">&#39;uniform&#39;</span>, <span class="dt">main=</span><span class="st">&#39;Uniform species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-21-1.png" title="_A prioritisation for the uniformly distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" alt="_A prioritisation for the uniformly distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the difference between old and new prioritisations</span>
<span class="kw">plot</span>(sim_rs_s1_amount, sim_rs_s1_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-22-1.png" title="_Difference between two prioritisations for the uniformly distributed species. Prioritisation $X$ was generated using just amount-based targets (20\%), and prioritisation $Y$ was generated using an additional space-based target (85\%)._" alt="_Difference between two prioritisations for the uniformly distributed species. Prioritisation $X$ was generated using just amount-based targets (20\%), and prioritisation $Y$ was generated using an additional space-based target (85\%)._" style="display: block; margin: auto;" /></p>
<p>Here we can see that by including a space-target, the prioritisation is spread out evenly across the species’ distribution. Unlike the amount-based prioritisation, this prioritisation samples all the different parts of the species’ distribution.</p>
<p>Now, let’s generate a prioritisation for the normally distributed species that considers amount-based and space-based targets. Then, let’s visualise the new prioritisation and compare it to the old amount-based prioritisation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation</span>
sim_rs_s2_space &lt;-<span class="st"> </span><span class="kw">update</span>(sim_rs_s2_amount, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="fl">0.85</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 10102 rows, 10100 columns and 40000 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-02, 4e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 6e+01]
## Found heuristic solution: objective 91
## Presolve removed 220 rows and 0 columns
## Presolve time: 1.91s
## Presolved: 9882 rows, 10100 columns, 41664 nonzeros
## Variable types: 0 continuous, 10100 integer (10100 binary)
## Presolved: 9882 rows, 10100 columns, 41664 nonzeros
## 
## Presolve removed 9882 rows and 10100 columns
## 
## Root relaxation: objective 1.232570e+01, 4135 iterations, 0.29 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0   12.32570    0  290   91.00000   12.32570  86.5%     -    2s
## H    0     0                      13.0000000   12.32570  5.19%     -    2s
## 
## Explored 0 nodes (4369 simplex iterations) in 2.38 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.300000000000e+01, best bound 1.300000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_rs_s2_space)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    13   13             13                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               5               173               42
##   Connectivity_In_Fraction
## 1               0.02272727</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s2_space)</code></pre></div>
<pre><code>##      normal
## 1 0.2014166</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s2_space)</code></pre></div>
<pre><code>##   normal (Space 1)
## 1          0.85809</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the normal species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s2_space, <span class="st">&#39;normal&#39;</span>, <span class="dt">main=</span><span class="st">&#39;Normal species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-25-1.png" title="_A prioritisation for the normally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" alt="_A prioritisation for the normally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the difference between old and new prioritisations</span>
<span class="kw">plot</span>(sim_rs_s2_amount, sim_rs_s2_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-26-1.png" title="_Difference between two prioritisations for the normally distributed species. See Figure 7 caption for conventions._" alt="_Difference between two prioritisations for the normally distributed species. See Figure 7 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>We can see by using both amount-based and space-based targets we can obtain a prioritisation that secures both the species’ range core and parts of its range margin. As a consequence, it may capture any novel adaptations found along the species’ range margin–unlike the amount-based prioritisation.</p>
<p>Finally, let’s generate a prioritisation for the bimodal species using amount-based and space-based targets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation</span>
sim_rs_s3_space &lt;-<span class="st"> </span><span class="kw">update</span>(sim_rs_s3_amount, <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="fl">0.85</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 10102 rows, 10100 columns and 40000 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 7e+01]
## Found heuristic solution: objective 86
## Presolve removed 589 rows and 15 columns
## Presolve time: 3.27s
## Presolved: 9513 rows, 10085 columns, 51461 nonzeros
## Variable types: 0 continuous, 10085 integer (10085 binary)
## Presolved: 9513 rows, 10085 columns, 51461 nonzeros
## 
## Presolve removed 9513 rows and 10085 columns
## 
## Root relaxation: objective 8.980792e+00, 6437 iterations, 0.45 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0    8.98079    0   75   86.00000    8.98079  89.6%     -    3s
## H    0     0                      10.0000000    8.98079  10.2%     -    3s
##      0     0    8.99662    0  125   10.00000    8.99662  10.0%     -    4s
## 
## Cutting planes:
##   Gomory: 1
##   Zero half: 1
## 
## Explored 0 nodes (6761 simplex iterations) in 4.18 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.000000000000e+01, best bound 1.000000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_rs_s3_space)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    10   10             10                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               6               186               28
##   Connectivity_In_Fraction
## 1               0.02727273</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held</span>
<span class="kw">amount.held</span>(sim_rs_s3_space)</code></pre></div>
<pre><code>##     bimodal
## 1 0.2127869</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held</span>
<span class="kw">space.held</span>(sim_rs_s3_space)</code></pre></div>
<pre><code>##   bimodal (Space 1)
## 1         0.8650189</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the prioritisation and the bimodal species&#39; distribution</span>
<span class="kw">spp.plot</span>(sim_rs_s3_space, <span class="st">&#39;bimodal&#39;</span>, <span class="dt">main=</span><span class="st">&#39;Bimodal species&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-29-1.png" title="_A prioritisation for the normally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" alt="_A prioritisation for the normally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 3 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot the difference between old and new prioritisations</span>
<span class="kw">plot</span>(sim_rs_s3_amount, sim_rs_s3_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-30-1.png" title="_Difference between two prioritisations for the bimodally distributed species. See Figure 7 caption for conventions._" alt="_Difference between two prioritisations for the bimodally distributed species. See Figure 7 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>Earlier we found that the amount-based prioritisation only preserved individuals from a single ecotype, and would have failed to adequately preserve the intra-specific variation for this species. However, here we can see that by including space-based targets, we can develop prioritisations that secure individuals belonging to both ecotypes. This new prioritisation is much more effective at sampling the intra-specific variation for this species.</p>
<p>Overall, these results demonstrate that under the simplest of conditions, the use of space-based targets can improve prioritisations. However, these prioritisations were each generated for a single species. Prioritisations generated using multiple species may do a better job at preserving the intra-specific variation for individuals species by preserving them in different parts of their range. We will investigate this in the next section.</p>
</div>
</div>
<div id="multi-species-prioritisations" class="section level2">
<h2>Multi-species prioritisations</h2>
<div id="effects-of-including-space-based-targets" class="section level3">
<h3>Effects of including space-based targets</h3>
<p>So far we have generated prioritisations using only a single species at a time. However, real world prioritisations are often generated using multiple species to ensure that they preserve a comprehensive set of biodiversity. Here, we will generate multi-species prioritisations that preserve all three of the simulated species. First, we will generate a prioritisation using amount-based targets that only aims to preserve 20% of the area they occupy. Then, we will generate a prioritisation that also incoperate space-based targets to also preserve 85% of their geographic distribution. We will then compare the two prioritisations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make prioritisations</span>
sim_mrs_amount &lt;-<span class="st"> </span><span class="kw">update</span>(
    sim_ru,
    <span class="dt">amount.target=</span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>),
    <span class="dt">space.target=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),
    <span class="dt">Threads=</span>threads
)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 30306 rows, 30100 columns and 120000 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 8e+02]
## Found heuristic solution: objective 98
## Presolve time: 1.59s
## Presolved: 30306 rows, 30100 columns, 120000 nonzeros
## Variable types: 0 continuous, 30100 integer (30100 binary)
## Presolved: 30306 rows, 30100 columns, 120000 nonzeros
## 
## Presolve removed 30306 rows and 30100 columns
## 
## Root relaxation: objective 2.000000e+01, 2021 iterations, 1.47 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## *    0     0               0      20.0000000   20.00000  0.00%     -    3s
## 
## Explored 0 nodes (4785 simplex iterations) in 3.79 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.000000000000e+01, best bound 2.000000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_mrs_space &lt;-<span class="st"> </span><span class="kw">update</span>(
    sim_ru,
    <span class="dt">amount.target=</span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.2</span>),
    <span class="dt">space.target=</span><span class="kw">c</span>(<span class="fl">0.85</span>, <span class="fl">0.85</span>, <span class="fl">0.85</span>),
    <span class="dt">Threads=</span>threads
)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 30306 rows, 30100 columns and 120000 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 1e+02]
## Found heuristic solution: objective 100
## Presolve removed 322 rows and 15 columns (presolve time = 5s) ...
## Presolve removed 360 rows and 15 columns
## Presolve time: 6.71s
## Presolved: 29946 rows, 30085 columns, 131504 nonzeros
## Variable types: 0 continuous, 30085 integer (30085 binary)
## Presolve removed 53 rows and 1 columns
## Presolved: 29893 rows, 30084 columns, 127236 nonzeros
## 
## Presolve removed 29893 rows and 30084 columns
## 
## Root simplex log...
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##        0    1.0000000e+02   0.000000e+00   1.000000e+02      8s
##     4358    2.0000000e+01   0.000000e+00   0.000000e+00      9s
##     4358    2.0000000e+01   0.000000e+00   0.000000e+00      9s
## 
## Root relaxation: objective 2.000000e+01, 4358 iterations, 1.82 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## *    0     0               0      20.0000000   20.00000  0.00%     -    8s
## 
## Explored 0 nodes (6369 simplex iterations) in 8.87 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.000000000000e+01, best bound 2.000000000000e+01, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summaries</span>
<span class="kw">summary</span>(sim_mrs_amount)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    20   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1              10               145               65
##   Connectivity_In_Fraction
## 1               0.04545455</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(sim_mrs_space)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    20   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               7               140               73
##   Connectivity_In_Fraction
## 1               0.03181818</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held for each prioritisation</span>
<span class="kw">amount.held</span>(sim_mrs_amount)</code></pre></div>
<pre><code>##   uniform    normal   bimodal
## 1     0.2 0.2214677 0.2502513</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">amount.held</span>(sim_mrs_space)</code></pre></div>
<pre><code>##   uniform    normal   bimodal
## 1     0.2 0.2111175 0.2175549</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held for each prioritisation</span>
<span class="kw">space.held</span>(sim_mrs_amount)</code></pre></div>
<pre><code>##   uniform (Space 1) normal (Space 1) bimodal (Space 1)
## 1         0.9145455        0.8898895         0.9234012</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">space.held</span>(sim_mrs_space)</code></pre></div>
<pre><code>##   uniform (Space 1) normal (Space 1) bimodal (Space 1)
## 1         0.9333333        0.9111715          0.931071</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot multi-species prioritisation with amount-based targets</span>
<span class="kw">plot</span>(sim_mrs_amount, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Amount-based targets&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-33-1.png" title="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using just amount-based targets (20\%). Squares represent planning units. Dark green planning units are selected for preservation._" alt="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using just amount-based targets (20\%). Squares represent planning units. Dark green planning units are selected for preservation._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot multi-species prioritisation with amount- and space-based targets</span>
<span class="kw">plot</span>(sim_mrs_space, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Amount and space-based targets&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-34-1.png" title="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 12 caption for conventions._" alt="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). See Figure 12 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># difference between the two prioritisations</span>
<span class="kw">plot</span>(sim_mrs_amount, sim_mrs_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-35-1.png" title="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions.)" alt="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions.)" style="display: block; margin: auto;" /></p>
<p>Here we can see that the inclusion of space-based targets changes which planning units are selected for prioritisation, but also the number of planning units that are selected. The amount-based prioritisation is comprised of 20 units, and the space-based prioritisation is comprised of 20 units. This result suggests that an adequate and representative prioritisation can be achieved for only a minor increase in cost.</p>
</div>
<div id="uncertainty-in-species-distributions" class="section level3">
<h3>Uncertainty in species’ distributions</h3>
<p>The unreliable formulation does not consider the probability that the planning units are occupied by features when calculating how well a given solution secures a representative sample of an attribute space. Thus solutions identified using the unreliable formulation may select regions of an attribute space for a species using planning units that only have a small chance of being inhabited. As a consequence, if the prioritisation is implemented, it may fail to secure regions of an attribute space if individuals do not inhabit these planning units, and ultimately fail to fulfil the space-based targets.</p>
<p>A simple solution to this issue would be to ensure that planning units cannot be assigned to demand points if they have a low probability of occupancy. This can be achieved by setting a probability threshold for planning units, such that planning units with a probability of occupancy below the threshold are effectively set to zero.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation with probability threshold of 0.1 for each species</span>
sim_mrs_space2 &lt;-<span class="st"> </span><span class="kw">solve</span>(
    <span class="kw">prob.subset</span>(
        sim_mrs_space,
        <span class="dt">species=</span><span class="dv">1</span>:<span class="dv">3</span>,
        <span class="dt">threshold=</span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>)
    ),
    <span class="dt">Threads=</span>threads
)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 30306 rows, 30100 columns and 119974 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e+01]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 1e+02]
## Found heuristic solution: objective 100
## Presolve removed 271 rows and 15 columns (presolve time = 5s) ...
## Presolve removed 360 rows and 15 columns
## Presolve time: 7.65s
## Presolved: 29946 rows, 30085 columns, 131478 nonzeros
## Variable types: 0 continuous, 30085 integer (30085 binary)
## Presolve removed 53 rows and 1 columns
## Presolved: 29893 rows, 30084 columns, 127210 nonzeros
## 
## Presolve removed 29893 rows and 30084 columns
## 
## Root simplex log...
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##        0    1.0000000e+02   0.000000e+00   1.000000e+02      9s
##     3717    2.0000000e+01   0.000000e+00   0.000000e+00      9s
##     3717    2.0000000e+01   0.000000e+00   0.000000e+00      9s
## 
## Root relaxation: objective 2.000000e+01, 3717 iterations, 1.56 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0   20.00000    0  216  100.00000   20.00000  80.0%     -    9s
## H    0     0                      22.0000000   20.00000  9.09%     -    9s
## 
## Explored 0 nodes (7281 simplex iterations) in 10.00 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.200000000000e+01, best bound 2.000000000000e+01, gap 9.0909%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_mrs_space2)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    22   22             22                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1               8               134               78
##   Connectivity_In_Fraction
## 1               0.03636364</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation</span>
<span class="kw">plot</span>(sim_mrs_space2, <span class="dv">1</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-38-1.png" title="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). This priorititisation was generated to be robust against low occupancy probabilities, by preventing planning units with low probabilities from being used to represent demand points. See Figure 12 caption for conventions._" alt="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). This priorititisation was generated to be robust against low occupancy probabilities, by preventing planning units with low probabilities from being used to represent demand points. See Figure 12 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># difference between prioritisations that use and do not use thresholds</span>
<span class="kw">plot</span>(sim_mrs_space2, sim_mrs_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-39-1.png" title="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" alt="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>But this method requires setting somewhat arbitrary thresholds. A more robust solution to this issue is to actually use the probability that species occupy planning units to generate the prioritisations. This is what the reliable formulation does. First we will try and generate a solution using existing targets and the reliable formulation. To reduce computational time, we will set the maximum backup <span class="math inline">\(R\)</span>-level to 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation using reliable formulation</span>
sim_mrs_space3 &lt;-<span class="st"> </span><span class="kw">try</span>(<span class="kw">update</span>(sim_mrs_space, <span class="dt">formulation=</span><span class="st">&#39;reliable&#39;</span>, <span class="dt">max.r.level=</span>1L, <span class="dt">Threads=</span>threads))</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 364206 rows, 181900 columns and 3847200 nonzeros
## Coefficient statistics:
##   Matrix range    [8e-04, 1e+02]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [7e-03, 1e+02]
## Presolve removed 338706 rows and 90806 columns
## Presolve time: 4.31s
## 
## Explored 0 nodes (0 simplex iterations) in 5.91 seconds
## Thread count was 1 (of 24 available processors)
## 
## Model is infeasible
## Best objective -, best bound -, gap -</code></pre>
<p>However, this fails. The reason why we cannot generate a prioritisation that fulfills these targets is because even the solution that contains all the planning units is still insufficient when we consider probabilities. The negative maximum targets printed in the error message indicate that planning units have low probabilities of occupancy. To fulfill the targets, we must obtain more planning units with higher probabilities of occupancy. We also could attempt resolving the problem using a higher <span class="math inline">\(R\)</span>-level. Instead, we will set lower targets and generate solution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make new prioritisation using reliable formulation and reduced targets</span>
sim_mrs_space3 &lt;-<span class="st"> </span><span class="kw">update</span>(
    sim_mrs_space,
    <span class="dt">formulation=</span><span class="st">&#39;reliable&#39;</span>,
    <span class="dt">max.r.level=</span>1L,
    <span class="dt">space.target=</span>-<span class="dv">1000</span>,
    <span class="dt">Threads=</span>threads
)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 364206 rows, 181900 columns and 3847200 nonzeros
## Coefficient statistics:
##   Matrix range    [8e-04, 1e+02]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [7e-03, 8e+05]
## Presolve removed 333703 rows and 151600 columns (presolve time = 5s) ...
## Presolve removed 333903 rows and 151800 columns
## Presolve time: 8.74s
## Presolved: 30303 rows, 30100 columns, 90300 nonzeros
## Variable types: 0 continuous, 30100 integer (30100 binary)
## Found heuristic solution: objective 27.0000000
## Presolved: 30303 rows, 30100 columns, 90300 nonzeros
## 
## Presolve removed 30303 rows and 30100 columns
## 
## Root simplex log...
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##        0    1.0000000e+02   0.000000e+00   1.000000e+02     11s
##      129    2.0000000e+01   0.000000e+00   0.000000e+00     11s
##      129    2.0000000e+01   0.000000e+00   0.000000e+00     11s
## 
## Root relaxation: objective 2.000000e+01, 129 iterations, 0.47 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
## *    0     0               0      20.0000000   20.00000  0.00%     -   11s
## 
## Explored 0 nodes (176 simplex iterations) in 11.16 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 2.000000000000e+01, best bound 2.000000000000e+01, gap 0.0%</code></pre>
<pre><code>## Warning in validityMethod(object): object@space.held contains values less
## than 0, some species are really poorly represented</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(sim_mrs_space3)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL    20   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1              21               157               42
##   Connectivity_In_Fraction
## 1               0.09545455</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation</span>
<span class="kw">plot</span>(sim_mrs_space3, <span class="dv">1</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-43-1.png" title="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). This priorititisation was generated to be robust against low occupancy probabilities, by explicitly using the probability of occupancy data when deriving a solution. See Figure 12 caption for conventions._" alt="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using amount-based targets (20\%) and space-based targets (85\%). This priorititisation was generated to be robust against low occupancy probabilities, by explicitly using the probability of occupancy data when deriving a solution. See Figure 12 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># difference between prioritisations based on unreliable and reliable formulation</span>
<span class="kw">plot</span>(sim_mrs_space3, sim_mrs_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-44-1.png" title="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" alt="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>An additional planning unit was selected using the reliable formulation. The prioritisation based on the unreliable formulation had 20 planning units, but the prioritisation based on the reliable formlation has 20 planning units. This difference occurs because the reliable formulation needs to ensure that all selected planning units with a low chance of being occupied have a suitable backup planning unit. While the reliable formulation can deliver more robust prioritisations, it takes much longer to solve conservation planning problems expressed using this formulation than the unreliable formulation. As a consequence, the reliable formulation is only feasible for particularly small problems, such as those involving few features and less than several hundred planning units.</p>
</div>
<div id="fragmentation" class="section level3">
<h3>Fragmentation</h3>
<p>Fragmentation is an important consideration in real-world planning situations. Up until now, we haven’t considered the effects of fragmentation on the viability of the prioritisation. As a consequence, our prioritisations have tended to contain planning units without any neighbours. We can use the <code>BLM</code> parameter to penalise fragmented solutions.</p>
<p>Let’s generate a new prioritisation that heavily penalises fragmentation. Here, we will update the <code>sim_mrs_amount</code> object with <code>BLM</code> of 100.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># update prioritisation</span>
sim_mrs_amount_blm &lt;-<span class="st"> </span><span class="kw">update</span>(sim_mrs_amount, <span class="dt">BLM=</span><span class="dv">100</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Warning for adding variables: zero or small (&lt; 1e-13) coefficients, ignored
## Optimize a model with 30666 rows, 30280 columns and 120720 nonzeros
## Coefficient statistics:
##   Matrix range    [7e-03, 9e+01]
##   Objective range [1e+02, 4e+02]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 8e+02]
## Found heuristic solution: objective 4498
## Presolve time: 1.29s
## Presolved: 30666 rows, 30280 columns, 120720 nonzeros
## Variable types: 0 continuous, 30280 integer (30280 binary)
## Presolved: 30666 rows, 30280 columns, 120720 nonzeros
## 
## Presolve removed 30666 rows and 30280 columns
## 
## Root simplex log...
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##     6188    5.5154048e+02   0.000000e+00   6.006546e+05      5s
##     7593    4.6444444e+02   0.000000e+00   0.000000e+00      6s
##     7593    4.6444444e+02   0.000000e+00   0.000000e+00      6s
## 
## Root relaxation: objective 4.644444e+02, 7593 iterations, 4.60 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  464.44444    0 1725 4498.00000  464.44444  89.7%     -    6s
## H    0     0                    1531.0000000  464.44444  69.7%     -   19s
## H    0     0                    1122.0000000  464.44444  58.6%     -   20s
##      0     0  519.36948    0 1447 1122.00000  519.36948  53.7%     -   21s
##      0     0  519.36948    0 1451 1122.00000  519.36948  53.7%     -   22s
##      0     0  556.17021    0 1520 1122.00000  556.17021  50.4%     -   23s
##      0     0  556.17021    0 1527 1122.00000  556.17021  50.4%     -   23s
##      0     0  556.17021    0 1540 1122.00000  556.17021  50.4%     -   24s
##      0     0  556.17021    0 1542 1122.00000  556.17021  50.4%     -   24s
##      0     0  556.17021    0 1499 1122.00000  556.17021  50.4%     -   25s
##      0     0  556.17021    0 1500 1122.00000  556.17021  50.4%     -   27s
##      0     0  556.17021    0 1477 1122.00000  556.17021  50.4%     -   30s
##      0     0  556.17021    0 1480 1122.00000  556.17021  50.4%     -   33s
## H    0     0                    1120.0000000  556.17021  50.3%     -   33s
##      0     0  556.17021    0 1483 1120.00000  556.17021  50.3%     -   34s
##      0     0  556.17021    0 1481 1120.00000  556.17021  50.3%     -   34s
##      0     2  556.17021    0 1456 1120.00000  556.17021  50.3%     -   39s
##      4     6  597.22193    4 1400 1120.00000  561.88348  49.8%  1488   40s
##     21    29  622.98118    9 1103 1120.00000  600.00000  46.4%  1271   46s
##     95   109  693.30843   14 1217 1120.00000  625.08266  44.2%  1005   51s
##    303   264  834.28571   19  615 1120.00000  625.08266  44.2%   631   58s
##    458   391  960.00000   23  339 1120.00000  625.08266  44.2%   618   62s
##    584   484 1020.00000   34    2 1120.00000  637.61095  43.1%   621   68s
## H  649   436                    1020.0000000  637.61095  37.5%   559   68s
## H  821   350                     920.0000000  653.33333  29.0%   567   84s
##    906   309  833.88199   13 1026  920.00000  654.69388  28.8%   560   93s
##   1311   332  870.00000   20  985  920.00000  736.32265  20.0%   528  102s
##   1755   272     cutoff   20       920.00000  778.17223  15.4%   522  112s
##   2375    48     cutoff   25       920.00000  816.00000  11.3%   495  122s
## 
## Cutting planes:
##   Gomory: 2
##   Zero half: 206
## 
## Explored 3021 nodes (1421545 simplex iterations) in 122.16 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 9.200000000000e+02, best bound 8.520000000000e+02, gap 7.3913%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary of prioritisation</span>
<span class="kw">summary</span>(sim_mrs_amount_blm)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL   920   20             20                220
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1              31               171               18
##   Connectivity_In_Fraction
## 1                0.1409091</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show amount held for each prioritisation</span>
<span class="kw">amount.held</span>(sim_mrs_amount_blm)</code></pre></div>
<pre><code>##   uniform    normal   bimodal
## 1     0.2 0.3185057 0.3911267</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show space held for each prioritisation</span>
<span class="kw">space.held</span>(sim_mrs_amount_blm)</code></pre></div>
<pre><code>##   uniform (Space 1) normal (Space 1) bimodal (Space 1)
## 1               0.6        0.6277996         0.6899822</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation</span>
<span class="kw">plot</span>(sim_mrs_amount_blm, <span class="dv">1</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-47-1.png" title="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using only amount-based targets (20\%). Additionally, this priorititisation was specified to have high connectivity, by using a high $BLM$ parameter. See Figure 12 caption for conventions._" alt="_A multi-species prioritisation for the uniformly, normally, and bimodally distributed species generated using only amount-based targets (20\%). Additionally, this priorititisation was specified to have high connectivity, by using a high $BLM$ parameter. See Figure 12 caption for conventions._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># difference between the two prioritisations</span>
<span class="kw">plot</span>(sim_mrs_amount_blm, sim_mrs_amount, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Difference between solutions&#39;</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-48-1.png" title="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" alt="_Difference between two multi-species prioritisations. See Figure 7 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>Here we can see that the prioritisation generated using a <code>BLM</code> parameter of 100 is much more clustered than the prioritisation generated using a <code>BLM</code> of 0. In practice, conservation planners will need to try a variety of <code>BLM</code> parameters to find a suitable prioritisation.</p>
</div>
</div>
</div>
<div id="case-study-examples" class="section level1">
<h1>Case-study examples</h1>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Here we will investigate how space-based targets can affect prioritisations using a more realistic dataset. We will generate prioritisations for the four bird species–<a href="http://www.birdlife.org/datazone/speciesfactsheet.php?id=1092&amp;gclid=CjwKEAiApYGyBRC-g_jIstuduV8SJABCEzhZoONUy8VlwRZqeFB1Z5M03CjyneIvX8KdVKIPZvckrRoCgJDw_wcB">blue-winged kookaburra</a>, <a href="http://www.birdlife.org/datazone/species/factsheet/22704394?gclid=CjwKEAiApYGyBRC-g_jIstuduV8SJABCEzhZHxCTcR38YnFlhePYt19gD31lqxxwrMmtIuWFhUwLmRoCGJjw_wcB">brown-backed honeyeater</a>, <a href="http://www.birdlife.org/datazone/speciesfactsheet.php?id=3588">brown falcon</a>, <a href="http://www.birdlife.org/datazone/speciesfactsheet.php?id=1466">pale-headed rosella</a>–in Queensland, Australia. This region contains a broad range of different habitats–such as rainforests, woodlands, and deserts–making it ideal for this tutorial. First, we will generate a typical amount-based prioritisation that aims to capture 20% of the species’ distributions. Then we will generate a prioritisation that also aims to secure populations in representative parts of the species’ distributions in terms of their geographic location and their environmental heterogeneity. To do this we will generate a prioritisation using 20% amount-based targets and 85% space-based targets. Finally, we will compare these prioritisations to Australia’s existing protected network.</p>
</div>
<div id="data-1" class="section level2">
<h2>Data</h2>
<p>To map the coarse-scale distributions of the four bird species, we obtained observation data from the Atlas of Living Australia across the whole of Australia (<a href="https://github.com/AtlasOfLivingAustralia/ALA4R">using the developmental version of the <em>ALA4R R</em> package</a>), spatially thinned the data to omit points within 10,000 km<span class="math inline">\(^2\)</span> of each other to ameliorate the effects of sampling bias (<a href="www.github.com/mlammens/spThin">using the developmental version of the <em>spThin</em> R package</a>), and fit 85 % minimum convex polygons (using the <em>adehabitatHR</em> <em>R</em> package). We used this method because it is entirely reproducible using freely available data. The code used to generate this maps is available in the <a href="https://github.com/jeffreyhanson/raptr-manuscript">GitHub repository for the scientific article accompanying this R package</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data</span>
<span class="kw">data</span>(cs_spp)

<span class="co"># plot species&#39; distributions</span>
<span class="kw">plot</span>(cs_spp, <span class="dt">main=</span><span class="kw">c</span>(
    <span class="st">&quot;Blue-winged kookaburra&quot;</span>, <span class="st">&quot;Brown-backed honeyeater&quot;</span>, 
    <span class="st">&quot;Brown falcon&quot;</span>, <span class="st">&quot;Pale-headed rosella&quot;</span>
))</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-49-1.png" title="_Distribution map for four Australian bird species. ._" alt="_Distribution map for four Australian bird species. ._" style="display: block; margin: auto;" /></p>
<p>Planning units (50km<span class="math inline">\(^2\)</span> resolution) were generated across Australia, and then clipped to the <a href="http://www.abs.gov.au/ausstats/abs@.nsf/mf/1259.0.30.001?OpenDocument">Queensland state borders and coastline</a>. <strong>Note that we are using excessively coarse planning units so that our examples will complete relatively quickly. In a real-world planning exercise, we would use much finer planning units.</strong> To compare our prioritisations to <a href="http://www.protectedplanet.net/country/AU">Queensland’s existing protected area network</a>, this network was intersected with the planning units. Planning units with more than 50% of their area inside a protected area had their status set to 2 (<a href="http://marxan.net/downloads/uq_marxan_web_2/module4.html">following conventions in <em>Marxan</em></a>). Since we do not have cost data, the prioritisations will aim to select the minimum number of planning units required to meet the targets. The planning units are stored in the <code>cs_pu</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data</span>
<span class="kw">data</span>(cs_pus)

## plot planning units
<span class="co"># convert SpatialPolygons to PolySet for quick plotting</span>
cs_pus2 &lt;-<span class="st"> </span><span class="kw">SpatialPolygons2PolySet</span>(cs_pus)

<span class="co"># create vector of colours for planning units</span>
<span class="co"># + light green: units not already inside reserve</span>
<span class="co"># + yellow: units already inside reserve</span>
cs_pus_cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&#39;#c7e9c0&#39;</span>, <span class="kw">nrow</span>(cs_pus@data))
cs_pus_cols[<span class="kw">which</span>(cs_pus$status==<span class="dv">2</span>)] &lt;-<span class="st"> &#39;yellow&#39;</span>

<span class="co"># set plotting window</span>
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>, <span class="fl">4.1</span>, <span class="fl">0.1</span>))

<span class="co"># plot polygons</span>
PBSmapping::<span class="kw">plotPolys</span>(
    cs_pus2, <span class="dt">col=</span>cs_pus_cols, <span class="dt">border=</span><span class="st">&#39;gray30&#39;</span>, 
    <span class="dt">xlab=</span><span class="st">&#39;&#39;</span>, <span class="dt">ylab=</span><span class="st">&#39;&#39;</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>, 
    <span class="dt">main=</span><span class="st">&#39;Case-study planning units&#39;</span>,
    <span class="dt">cex=</span><span class="fl">1.8</span>
)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-50-1.png" title="_Planning units for the case-study examples. Polygons denote planning units. Yellow units have more than 50\% of their area already in a reserve.)" alt="_Planning units for the case-study examples. Polygons denote planning units. Yellow units have more than 50\% of their area already in a reserve.)" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># reset plotting window</span>
<span class="kw">par</span>(<span class="dt">mar=</span><span class="kw">c</span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</code></pre></div>
<p>To map the distribution of environmental conditions across the species’ range, 21 <a href="http://www.worldclim.org/bioclim">bioclimatic layers</a> were obtained. These layers were cropped to Australia and subject to <a href="http://cc.oulu.fi/~jarioksa/softhelp/vegan/html/decorana.html">detrended correspondence analysis</a> to produce two new variables. These layers are stored in the <code>cs_space</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load data</span>
<span class="kw">data</span>(cs_space)

<span class="co"># plot variables</span>
<span class="kw">plot</span>(cs_space, <span class="dt">main=</span><span class="kw">c</span>(<span class="st">&#39;DC1&#39;</span>, <span class="st">&#39;DC2&#39;</span>), <span class="dt">legend=</span><span class="ot">FALSE</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-51-1.png" title="_Broad-scale environmental variation across Australia. The variable DC1 describes the transition from wet and cool to dry and hot conditions. The variable DC2 describes the transition from wet and hot to dry and cool conditions._" alt="_Broad-scale environmental variation across Australia. The variable DC1 describes the transition from wet and cool to dry and hot conditions. The variable DC2 describes the transition from wet and hot to dry and cool conditions._" style="display: block; margin: auto;" /></p>
</div>
<div id="analysis" class="section level2">
<h2>Analysis</h2>
<p>To simplify the process of formatting data and generating prioritisations, we can use the <code>rap</code> function. First, we will generate an amount-based prioritisation that aims to capture 10% of the rosella’s range. We will use 50 demand points to map the geographic and environmental spaces. <strong>Be warned, the examples hereafter can take 5-10 minutes to run.</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make amount-based prioritisation</span>
<span class="co"># and ignore existing protected areas by discarding values in the </span>
<span class="co"># status (third) column of the attribute table</span>
cs_rs_amount &lt;-<span class="st"> </span><span class="kw">rap</span>(
    cs_pus[,-<span class="dv">2</span>], cs_spp, cs_space,
    <span class="dt">amount.target=</span><span class="fl">0.2</span>, <span class="dt">space.target=</span><span class="ot">NA</span>, <span class="dt">n.demand.points=</span>50L,
    <span class="dt">include.geographic.space=</span><span class="ot">TRUE</span>, <span class="dt">formulation=</span><span class="st">&#39;unreliable&#39;</span>,
    <span class="dt">kernel.method=</span><span class="st">&#39;hypervolume&#39;</span>, <span class="dt">quantile=</span><span class="fl">0.7</span>, <span class="dt">solve=</span><span class="ot">FALSE</span>
)</code></pre></div>
<pre><code>## Warning in (function (pus, species, spaces = NULL, amount.target = 0.2, :
## argument to pus does not have a &#39;status&#39; column, creating default with all
## status=0L</code></pre>
<pre><code>## Evaluating probability density...
## Building tree... done.
## Querying tree... 3.02115e-06  0.0302145  0.060426  0.0906375  0.120849  0.15106  0.181272  0.211483  0.241695  0.271906  0.302118  0.332329  0.362541  0.392752  0.422964  0.453175  0.483387  0.513598  0.54381  0.574021  0.604233  0.634444  0.664656  0.694867  0.725079  0.75529  0.785502  0.815713  0.845924  0.876136  0.906347  0.936559  0.96677  0.996982  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.70
## Evaluating probability density...
## Building tree... done.
## Querying tree... 1.8622e-06  0.0186238  0.0372458  0.0558678  0.0744898  0.0931117  0.111734  0.130356  0.148978  0.1676  0.186222  0.204844  0.223466  0.242088  0.260709  0.279331  0.297953  0.316575  0.335197  0.353819  0.372441  0.391063  0.409685  0.428307  0.446929  0.465551  0.484173  0.502795  0.521417  0.540039  0.558661  0.577283  0.595905  0.614527  0.633149  0.651771  0.670393  0.689015  0.707637  0.726259  0.744881  0.763503  0.782125  0.800747  0.819369  0.837991  0.856613  0.875235  0.893857  0.912479  0.931101  0.949723  0.968345  0.986966  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.70
## Evaluating probability density...
## Building tree... done.
## Querying tree... 1.53846e-05  0.153862  0.307708  0.461554  0.6154  0.769246  0.923092  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.68
## Evaluating probability density...
## Building tree... done.
## Querying tree... 3.27869e-06  0.0327902  0.065577  0.0983639  0.131151  0.163938  0.196725  0.229511  0.262298  0.295085  0.327872  0.360659  0.393446  0.426233  0.45902  0.491807  0.524593  0.55738  0.590167  0.622954  0.655741  0.688528  0.721315  0.754102  0.786889  0.819675  0.852462  0.885249  0.918036  0.950823  0.98361  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.70
## Evaluating probability density...
## Building tree... done.
## Querying tree... 2.94985e-06  0.0295015  0.059  0.0884985  0.117997  0.147496  0.176994  0.206493  0.235991  0.26549  0.294988  0.324487  0.353985  0.383484  0.412982  0.442481  0.471979  0.501478  0.530976  0.560475  0.589973  0.619472  0.648971  0.678469  0.707968  0.737466  0.766965  0.796463  0.825962  0.85546  0.884959  0.914457  0.943956  0.973454  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.70
## Evaluating probability density...
## Building tree... done.
## Querying tree... 1.84162e-06  0.018418  0.0368343  0.0552505  0.0736667  0.0920829  0.110499  0.128915  0.147331  0.165748  0.184164  0.20258  0.220996  0.239413  0.257829  0.276245  0.294661  0.313077  0.331494  0.34991  0.368326  0.386742  0.405158  0.423575  0.441991  0.460407  0.478823  0.497239  0.515656  0.534072  0.552488  0.570904  0.58932  0.607737  0.626153  0.644569  0.662985  0.681401  0.699818  0.718234  0.73665  0.755066  0.773483  0.791899  0.810315  0.828731  0.847147  0.865564  0.88398  0.902396  0.920812  0.939228  0.957645  0.976061  0.994477  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.69
## Evaluating probability density...
## Building tree... done.
## Querying tree... 1.51515e-05  0.15153  0.303045  0.454561  0.606076  0.757591  0.909106  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.70
## Evaluating probability density...
## Building tree... done.
## Querying tree... 3.23625e-06  0.0323657  0.0647282  0.0970906  0.129453  0.161816  0.194178  0.22654  0.258903  0.291265  0.323628  0.35599  0.388353  0.420715  0.453078  0.48544  0.517803  0.550165  0.582528  0.61489  0.647252  0.679615  0.711977  0.74434  0.776702  0.809065  0.841427  0.87379  0.906152  0.938515  0.970877  done.
## Finished evaluating probability density.
## Beginning volume calculation... done. 
## Quantile requested: 0.70   obtained: 0.69</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate prioritisation</span>
cs_rs_amount &lt;-<span class="st"> </span><span class="kw">solve</span>(cs_rs_amount, <span class="dt">MIPGap=</span><span class="fl">0.1</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Optimize a model with 4 rows, 762 columns and 1592 nonzeros
## Coefficient statistics:
##   Matrix range    [2e+03, 2e+04]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [4e+05, 3e+06]
## Found heuristic solution: objective 136
## Presolve removed 4 rows and 762 columns
## Presolve time: 0.00s
## Presolve: All rows and columns removed
## 
## Explored 0 nodes (0 simplex iterations) in 0.00 seconds
## Thread count was 1 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.290000000000e+02, best bound 1.290000000000e+02, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(cs_rs_amount)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL   129  129            129           98882414
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1         8650000          81732414          8500000
##   Connectivity_In_Fraction
## 1               0.08747764</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation</span>
<span class="kw">plot</span>(cs_rs_amount, <span class="dv">1</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-54-1.png" title="_Multi-species prioritisation generated for four bird species using amount-based targets (20\%). See Figure 12 captions for conventions._" alt="_Multi-species prioritisation generated for four bird species using amount-based targets (20\%). See Figure 12 captions for conventions._" style="display: block; margin: auto;" /></p>
<p>We can also see how well the prioritisation secures the species’ distributions in the geographic and environmental attribute spaces.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation in geographic attribute space</span>
p1 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Blue-winged</span><span class="ch">\n</span><span class="st">kookaburra&#39;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Brown-backed</span><span class="ch">\n</span><span class="st">honeyeater&#39;</span>)
p3 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Brown falcon&#39;</span>)
p4 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Pale-headed</span><span class="ch">\n</span><span class="st">rosella&#39;</span>)
gridExtra::<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-55-1.png" title="_Distribution of amount-based prioritisation in the geographic attribute space. Points denote combinations of environmental conditions. Green and grey points represent planning unit selected for and not selected for prioritisation (respectively). Blue points denote demand points, and their size indicates their weighting._" alt="_Distribution of amount-based prioritisation in the geographic attribute space. Points denote combinations of environmental conditions. Green and grey points represent planning unit selected for and not selected for prioritisation (respectively). Blue points denote demand points, and their size indicates their weighting._" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation in environmental attribute space</span>
p1 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Blue-winged</span><span class="ch">\n</span><span class="st">kookaburra&#39;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Brown-backed</span><span class="ch">\n</span><span class="st">honeyeater&#39;</span>)
p3 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Brown falcon&#39;</span>)
p4 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_amount, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Pale-headed</span><span class="ch">\n</span><span class="st">rosella&#39;</span>)
gridExtra::<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-56-1.png" title="_Distribution of amount-based prioritisation in the environmental attribute space. See Figure 28 caption for conventions._" alt="_Distribution of amount-based prioritisation in the environmental attribute space. See Figure 28 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>Next, let’s generate a prioritisation using amount- and space-based targets. This prioritisation will secure 70% of the species distribution in geographic and environmental space.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># make amount- and space-based prioritisation</span>
cs_rs_space &lt;-<span class="st"> </span><span class="kw">update</span>(cs_rs_amount, <span class="dt">space.target=</span><span class="fl">0.7</span>, <span class="dt">Threads=</span>threads)</code></pre></div>
<pre><code>## Optimize a model with 159612 rows, 159962 columns and 638392 nonzeros
## Coefficient statistics:
##   Matrix range    [1e-03, 2e+04]
##   Objective range [1e+00, 1e+00]
##   Bounds range    [1e+00, 1e+00]
##   RHS range       [1e+00, 3e+06]
## Presolve removed 1620 rows and 1157 columns (presolve time = 5s) ...
## Presolve removed 2321 rows and 1157 columns (presolve time = 10s) ...
## Presolve removed 2696 rows and 1157 columns (presolve time = 15s) ...
## Presolve removed 2712 rows and 1157 columns (presolve time = 20s) ...
## Presolve removed 2831 rows and 1157 columns (presolve time = 25s) ...
## Presolve removed 3206 rows and 1157 columns (presolve time = 30s) ...
## Presolve removed 4250 rows and 1157 columns (presolve time = 35s) ...
## Presolve removed 6058 rows and 1157 columns (presolve time = 40s) ...
## Presolve removed 6174 rows and 1157 columns (presolve time = 45s) ...
## Presolve removed 6262 rows and 1157 columns (presolve time = 50s) ...
## Presolve removed 6262 rows and 1157 columns (presolve time = 55s) ...
## Presolve removed 6281 rows and 1157 columns (presolve time = 60s) ...
## Presolve removed 6289 rows and 1157 columns (presolve time = 65s) ...
## Presolve removed 6827 rows and 1157 columns (presolve time = 70s) ...
## Presolve removed 6844 rows and 1157 columns (presolve time = 75s) ...
## Presolve removed 6859 rows and 1157 columns (presolve time = 80s) ...
## Presolve removed 6859 rows and 1157 columns (presolve time = 91s) ...
## Presolve removed 6859 rows and 1157 columns
## Presolve time: 91.30s
## Presolved: 152753 rows, 158805 columns, 689640 nonzeros
## Variable types: 0 continuous, 158805 integer (158805 binary)
## Found heuristic solution: objective 266.0000000
## Found heuristic solution: objective 264.0000000
## Presolve removed 625 rows and 0 columns
## Presolved: 152128 rows, 158805 columns, 687725 nonzeros
## 
## Presolve removed 152128 rows and 158805 columns
## 
## Root simplex log...
## 
## Iteration    Objective       Primal Inf.    Dual Inf.      Time
##        0    7.3100000e+02   0.000000e+00   7.310000e+02     97s
##     5115    1.2890496e+02   0.000000e+00   0.000000e+00     98s
##     5115    1.2890496e+02   0.000000e+00   0.000000e+00     98s
## 
## Root relaxation: objective 1.289050e+02, 5115 iterations, 5.61 seconds
## 
##     Nodes    |    Current Node    |     Objective Bounds      |     Work
##  Expl Unexpl |  Obj  Depth IntInf | Incumbent    BestBd   Gap | It/Node Time
## 
##      0     0  128.90496    0    3  264.00000  128.90496  51.2%     -   98s
## H    0     0                     129.0000000  128.90496  0.07%     -   99s
## 
## Explored 0 nodes (8791 simplex iterations) in 99.25 seconds
## Thread count was 22 (of 24 available processors)
## 
## Optimal solution found (tolerance 1.00e-01)
## Best objective 1.290000000000e+02, best bound 1.290000000000e+02, gap 0.0%</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># show summary</span>
<span class="kw">summary</span>(cs_rs_space)</code></pre></div>
<pre><code>##   Run_Number  Status Score Cost Planning_Units Connectivity_Total
## 1          1 OPTIMAL   129  129            129           98882414
##   Connectivity_In Connectivity_Edge Connectivity_Out
## 1         4450000          77532414         16900000
##   Connectivity_In_Fraction
## 1               0.04500295</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation</span>
<span class="kw">plot</span>(cs_rs_space,<span class="dv">1</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-58-1.png" title="plot of chunk unnamed-chunk-58" alt="plot of chunk unnamed-chunk-58" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation in geographic attribute space</span>
p1 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Blue-winged</span><span class="ch">\n</span><span class="st">kookaburra&#39;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Brown-backed</span><span class="ch">\n</span><span class="st">honeyeater&#39;</span>)
p3 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Brown falcon&#39;</span>)
p4 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dt">main=</span><span class="st">&#39;Pale-headed</span><span class="ch">\n</span><span class="st">rosella&#39;</span>)
gridExtra::<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<div class="figure">
<img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-59-1.png" alt="Distribution of the amount- and space-based prioritisation in the geographic attribute space. See Figure 28 caption for conventions." />
<p class="caption"><em>Distribution of the amount- and space-based prioritisation in the geographic attribute space. See Figure 28 caption for conventions.</em></p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot prioritisation in environmental attribute space</span>
p1 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Blue-winged</span><span class="ch">\n</span><span class="st">kookaburra&#39;</span>)
p2 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Brown-backed</span><span class="ch">\n</span><span class="st">honeyeater&#39;</span>)
p3 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Brown falcon&#39;</span>)
p4 &lt;-<span class="st"> </span><span class="kw">space.plot</span>(cs_rs_space, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dt">main=</span><span class="st">&#39;Pale-headed</span><span class="ch">\n</span><span class="st">rosella&#39;</span>)
gridExtra::<span class="kw">grid.arrange</span>(p1, p2, p3, p4, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-60-1.png" title="_Distribution of the amount- and space-based prioritisation in the environmental attribute space. See Figure 28 caption for conventions._" alt="_Distribution of the amount- and space-based prioritisation in the environmental attribute space. See Figure 28 caption for conventions._" style="display: block; margin: auto;" /></p>
<p>Let’s compare these prioritisations with Queensland’s existing protected areas system. To do this, we can create update the <code>cs_rs_space</code> with manually specified solutions to create a <code>RapSolved</code> object to represent the Queensland’s reserve network.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># generate vector with Australia&#39;s selections</span>
aus_selections &lt;-<span class="st"> </span><span class="kw">which</span>(cs_pus$status&gt;<span class="dv">0</span>)

<span class="co"># create new object with Australia&#39;s network</span>
cs_rs_aus &lt;-<span class="st"> </span><span class="kw">update</span>(cs_rs_amount, <span class="dt">b=</span>aus_selections)</code></pre></div>
<p>Now, let’s plot the performance metrics for these prioritisations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># define standard error function</span>
se=function(x){<span class="kw">sd</span>(x,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)/<span class="kw">sqrt</span>(<span class="kw">sum</span>(!<span class="kw">is.na</span>(x)))}

<span class="co"># create a table to store the values for the 3 prioritisations</span>
cs_results &lt;-<span class="st"> </span><span class="kw">data.frame</span>(
    <span class="dt">name=</span><span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;Amount-based</span><span class="ch">\n</span><span class="st">prioritisation&#39;</span>, 
        <span class="st">&#39;Amount &amp; space-based</span><span class="ch">\n</span><span class="st">prioritisation&#39;</span>, <span class="st">&#39;Queensland reserve</span><span class="ch">\n</span><span class="st">network&#39;</span>),
        <span class="dt">each=</span><span class="dv">4</span>),<span class="dv">3</span>), <span class="dt">levels=</span><span class="kw">c</span>(<span class="kw">c</span>(<span class="st">&#39;Amount-based</span><span class="ch">\n</span><span class="st">prioritisation&#39;</span>, 
        <span class="st">&#39;Amount &amp; space-based</span><span class="ch">\n</span><span class="st">prioritisation&#39;</span>, <span class="st">&#39;Queensland reserve</span><span class="ch">\n</span><span class="st">network&#39;</span>))),
    <span class="dt">variable=</span><span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&#39;Amount&#39;</span>, <span class="st">&#39;Geographic space&#39;</span>, <span class="st">&#39;Environmental space&#39;</span>), <span class="dt">each=</span><span class="dv">12</span>),
    <span class="dt">species=</span><span class="kw">colnames</span>(<span class="kw">amount.held</span>(cs_rs_amount)),
    <span class="dt">value=</span><span class="kw">c</span>(
        <span class="kw">amount.held</span>(cs_rs_amount)[<span class="dv">1</span>,], <span class="kw">amount.held</span>(cs_rs_space)[<span class="dv">1</span>,],
            <span class="kw">amount.held</span>(cs_rs_aus)[<span class="dv">1</span>,],
        <span class="kw">space.held</span>(cs_rs_amount, <span class="dt">space=</span><span class="dv">2</span>)[<span class="dv">1</span>,], <span class="kw">space.held</span>(cs_rs_space, <span class="dt">space=</span><span class="dv">2</span>)[<span class="dv">1</span>,], 
            <span class="kw">space.held</span>(cs_rs_aus, <span class="dt">space=</span><span class="dv">2</span>)[<span class="dv">1</span>,],
        <span class="kw">space.held</span>(cs_rs_amount, <span class="dt">space=</span><span class="dv">1</span>)[<span class="dv">1</span>,], <span class="kw">space.held</span>(cs_rs_space, <span class="dt">space=</span><span class="dv">1</span>)[<span class="dv">1</span>,],
            <span class="kw">space.held</span>(cs_rs_aus, <span class="dt">space=</span><span class="dv">1</span>)[<span class="dv">1</span>,]
    )
) %&gt;%<span class="st"> </span><span class="kw">group_by</span>(name,variable) %&gt;%
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean=</span><span class="kw">mean</span>(value),<span class="dt">se=</span><span class="kw">se</span>(value))

<span class="co"># plot the performance metrics</span>
<span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>variable, <span class="dt">y=</span>mean, <span class="dt">fill=</span>name), <span class="dt">data=</span>cs_results) +
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.9</span>), <span class="dt">stat=</span><span class="st">&#39;identity&#39;</span>) +
<span class="st">    </span><span class="kw">geom_errorbar</span>(
        <span class="kw">aes</span>(<span class="dt">ymin=</span>mean-se, <span class="dt">ymax=</span>mean+se), <span class="dt">position=</span><span class="kw">position_dodge</span>(<span class="fl">0.9</span>),
        <span class="dt">width=</span><span class="fl">0.2</span>) +
<span class="st">    </span><span class="kw">xlab</span>(<span class="st">&#39;Property of species&#39;</span>) +
<span class="st">    </span><span class="kw">ylab</span>(<span class="st">&#39;Proportion held in</span><span class="ch">\n</span><span class="st">selected planning units (%)&#39;</span>) +
<span class="st">    </span><span class="kw">scale_fill_discrete</span>(<span class="dt">name=</span><span class="st">&#39;&#39;</span>) +
<span class="st">    </span><span class="kw">theme_classic</span>() +
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&#39;bottom&#39;</span>,<span class="dt">legend.direction=</span><span class="st">&#39;horizontal&#39;</span>,
        <span class="dt">axis.line.x=</span><span class="kw">element_line</span>(),<span class="dt">axis.line.y=</span><span class="kw">element_line</span>())</code></pre></div>
<p><img src="/home/uqjhans4/GitHub/raptr/vignettes/figure/unnamed-chunk-62-1.png" title="_Prioritisations were generated using amount-based targets (20\%), and with additional space-based targets (85\%). These are compared to the Queensland reserve network. Data represent means and standard errors for the four species in each prioritisation._" alt="_Prioritisations were generated using amount-based targets (20\%), and with additional space-based targets (85\%). These are compared to the Queensland reserve network. Data represent means and standard errors for the four species in each prioritisation._" style="display: block; margin: auto;" /> We can see that a greater number of planning units is needed to satisfy the space-based targets. The prioritisation generated using just amount-based targets has 129 planning units, and the prioritisations using amount-based and space-based targets has 129 planning units. These results suggest only a few additional planning units can result in significant improvements in the effectivenss of a prioritisation.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs toc">

        <div id="nav">
      <h2>Contents</h2>
      <ul>
      <li><a href="#overview">Overview</a></li>
      <li><a href="#getting-started">Getting started</a></li>
      <li><a href="#simulated-examples">Simulated examples</a><ul>
      <li><a href="#data">Data</a></li>
      <li><a href="#single-species-prioritisations">Single-species prioritisations</a><ul>
      <li><a href="#amount-based-targets">Amount-based targets</a></li>
      <li><a href="#amount-based-and-space-based-targets">Amount-based and space-based targets</a></li>
      </ul></li>
      <li><a href="#multi-species-prioritisations">Multi-species prioritisations</a><ul>
      <li><a href="#effects-of-including-space-based-targets">Effects of including space-based targets</a></li>
      <li><a href="#uncertainty-in-species-distributions">Uncertainty in species’ distributions</a></li>
      <li><a href="#fragmentation">Fragmentation</a></li>
      </ul></li>
      </ul></li>
      <li><a href="#case-study-examples">Case-study examples</a><ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#data-1">Data</a></li>
      <li><a href="#analysis">Analysis</a></li>
      </ul></li>
      </ul>
    </div>
      </div>

</div>


<script>
$('#nav').affix({
  offset: {
    top: $('#nav').offset().top - 80
  }
});
</script>

        <footer>
        <p>Built by <a href="http://hadley.github.io/staticdocs/">staticdocs</a>. Styled with <a href="http://getbootstrap.com">Bootstrap 3</a>.</p>
        </footer>
   </div>

  </body>
</html>
